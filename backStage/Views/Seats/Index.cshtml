@model List<backStage.Models.Seat>
@{
    Layout = "_Layout";


    int rowCount = 15;   
    int seatsPerRow = 25;  
    var halls = ViewBag.HallList as List<int>;
}
@section Styles {
    <style>
        .full-height {
            height: calc(100vh - 6rem);
        }

        @@media (max-width: 767.98px) { /* Bootstrap 的 md 斷點 - 0.02 */
            .full-height {
                height: auto !important;
            }
        }
        
    </style>
}
<!-- ▽▽ 頁面本體 ▽▽ -->
<div class="container-fluid p-3 h-100">
    <div class="row gx-3 full-height mx-auto">

        <!-- 左側設定表單 -->
        <div class="col-12 col-md-3 col-lg-2 d-flex flex-column h-md-100 mb-3 mb-md-0">
            <div class="card flex-fill">
                <div class="card-body d-flex flex-column">
                    <div class="d-grid gap-2 mb-4">
                        <a asp-action="Create" asp-controller="Seats" class="btn btn-primary">新增影廳</a>
                        <a asp-action="Edit" asp-controller="Seats" class="btn btn-warning">編輯影廳</a>
                        <a id="deleteHallBtn" class="btn btn-danger disabled"
                           data-base="@Url.Action("DeleteHall", "Seats")">
                            刪除影廳
                        </a>
                    </div>
                    <div>
                        <label class="form-label">影廳名稱</label>
                        <select id="hallSelect" class="form-select">
                            <option value="">請選擇影廳</option>
                            @foreach (var h in halls)
                            {
                                <option value="@h">@h</option>
                            }
                        </select>
                    </div>
                    @* <form asp-action="Index" asp-controller="Seats" method="get"
                          class="d-flex flex-column gap-3 flex-grow-1">
                        <div>
                            <label class="form-label">影廳名稱</label>
                            <select id="hallSelect" name="theaterNumber" class="form-select">
                                <option value="">請選擇影廳</option>
                                @foreach (var h in halls)
                                {
                                    <option value="@h">@h</option>
                                }
                            </select>
                        </div>

                        <button type="submit"
                                class="btn btn-outline-primary w-100">
                            搜尋影廳
                        </button>
                    </form> *@

                </div>
            </div>
        </div>

        <!-- 右側座位表 -->
        <div class="col-12 col-md-9 col-lg-10 d-flex flex-column h-md-100 seat-col">
            <div class="card flex-fill">
                <div class="card-header">座位表</div>
                <div class="card-body p-0 d-flex flex-column">

                    <!-- 座位區（可水平捲動） -->
                    <div class="seats-wrapper">
                        <div class="row-container">

                            <!-- 螢幕示意圖 -->
                            <div class="movie-screen">
                                <img src="~/images/img/screen-thumb.png" alt="screen" />
                            </div>

                            <!-- 座位動態產生 -->
                            @for (int r = 0; r < rowCount; r++)
                            {
                                <div class="seat-row">
                                    @for (int c = 0; c < seatsPerRow; c++)
                                    {
                                        <div class="seat"></div>
                                    }
                                </div>
                            }
                            

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ▽▽ 點選變色腳本 ▽▽ -->
@section Scripts {
    <script>
        const seatWrapper  = document.querySelector('.seats-wrapper');
        seatWrapper.addEventListener('click', e=>{
            if(!e.target.classList.contains('seat') ||
               e.target.classList.contains('occupied')) return;
            e.target.classList.toggle('selected');
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const hallSelect = document.getElementById('hallSelect');
            const deleteBtn  = document.getElementById('deleteHallBtn');
            const baseUrl    = deleteBtn.dataset.base;      // /Seats/DeleteHall

            // ① 共用的啟用 / 停用函式
            const updateBtn = () => {
                const val = hallSelect.value.trim();        // 去掉空白
                if (val) {
                    deleteBtn.classList.remove('disabled');
                    deleteBtn.href = `${baseUrl}?theaterNumber=${val}`;
                } else {
                    deleteBtn.classList.add('disabled');
                    deleteBtn.href = "#";
                }
            };

            // ② 監聽選單變更
            hallSelect.addEventListener('change', updateBtn);

            // ③ 首頁載入時就判斷一次（避免回傳搜尋後仍顯示 disabled）
            updateBtn();
        });
    </script>
}


